<!-- A diagram for the SLICEL is shown in;
    7 Series FPGAs CLB User Guide UG474 (v1.8) September 27, 2016
    Figure 2-4: Diagram of SLICEL
  -->
<pb_type name="CLBLL" num_pb="1" xmlns:xi="http://www.w3.org/2001/XInclude">

  <input name="DX" num_pins="1" equivalent="false"/>
  <input name="D"  num_pins="6" equivalent="false"/>

  <input name="CX" num_pins="1" equivalent="false"/>
  <input name="C"  num_pins="6" equivalent="false"/>

  <input name="BX" num_pins="1" equivalent="false"/>
  <input name="B"  num_pins="6" equivalent="false"/>

  <input name="AX" num_pins="1" equivalent="false"/>
  <input name="A"  num_pins="6" equivalent="false"/>

  <input name="SR" num_pins="1" equivalent="false"/>
  <input name="CE" num_pins="1" equivalent="false"/>

  <clock name="CLK" num_pins="1" equivalent="false"/>

  <input  name="CARRY_IN"  num_pins="1" equivalent="false"/>
  <output name="CARRY_OUT" num_pins="1" equivalent="false"/>

  <output name="DMUX" num_pins="1" equivalent="false"/>
  <output name="Dout" num_pins="1" equivalent="false"/>
  <output name="DQ"   num_pins="1" equivalent="false"/>

  <output name="CMUX" num_pins="1" equivalent="false"/>
  <output name="Cout" num_pins="1" equivalent="false"/>
  <output name="CQ"   num_pins="1" equivalent="false"/>

  <output name="BMUX" num_pins="1" equivalent="false"/>
  <output name="Bout" num_pins="1" equivalent="false"/>
  <output name="BQ"   num_pins="1" equivalent="false"/>

  <output name="AMUX" num_pins="1" equivalent="false"/>
  <output name="Aout" num_pins="1" equivalent="false"/>
  <output name="AQ"   num_pins="1" equivalent="false"/>

  <!-- D6LUT, C6LUT, B6LUT, A6LUT == W6LUT
       A fracturable 6 input LUT. Can either be;
        - 2 * 5 input, 1 output LUT
        - 1 * 6 input, 1 output LUT
    -->
  <pb_type name="WLUT" num_pb="4">
    <input name="A"   num_pins="6"/>
    <output name="O5" num_pins="1"/>
    <output name="O6" num_pins="1"/>
    <mode name="lut6">
      <pb_type name="W6LUT" num_pb="1" class="lut" blif_model=".names">
        <input  name="in"  num_pins="6" port_class="lut_in" />
	<output name="out" num_pins="1" port_class="lut_out" />
        <delay_matrix type="max" in_port="W6LUT.in" out_port="W6LUT.out">
         0.068e-9
         0.068e-9
         0.068e-9
         0.068e-9
         0.068e-9
         0.068e-9
       </delay_matrix>
      </pb_type>
      <interconnect>
        <direct name="WLUT_A6" input="WLUT.A[5]" output="W6LUT.in[5]"/>
        <direct name="WLUT_A5" input="WLUT.A[4]" output="W6LUT.in[4]"/>
        <direct name="WLUT_A4" input="WLUT.A[3]" output="W6LUT.in[3]"/>
        <direct name="WLUT_A3" input="WLUT.A[2]" output="W6LUT.in[2]"/>
        <direct name="WLUT_A2" input="WLUT.A[1]" output="W6LUT.in[1]"/>
        <direct name="WLUT_A1" input="WLUT.A[0]" output="W6LUT.in[0]"/>
        <direct name="O6"      input="W6LUT.out" output="WLUT.O6"/>
      </interconnect>
    </mode>
    <mode name="lut5x2">
      <pb_type name="W5LUT" num_pb="2" class="lut" blif_model=".names">
        <input  name="in"  num_pins="5" port_class="lut_in" />
        <output name="out" num_pins="1" port_class="lut_out" />
        <delay_matrix type="max" in_port="W5LUT.in" out_port="W5LUT.out">
        	0.068e-9
        	0.068e-9
        	0.068e-9
        	0.068e-9
        	0.068e-9
        </delay_matrix>
      </pb_type>
      <interconnect>
	<!-- First LUT5 -->                                                 <!-- Second LUT5 -->
        <direct name="WLUT_A6"   input="WLUT.A[5]" output="W5LUT[0].in[4]"/><direct name="WLUT_A5"   input="WLUT.A[4]" output="W5LUT[1].in[4]"/>
        <direct name="WLUT_A4_0" input="WLUT.A[3]" output="W5LUT[0].in[3]"/><direct name="WLUT_A4_1" input="WLUT.A[3]" output="W5LUT[1].in[3]"/>
        <direct name="WLUT_A3_0" input="WLUT.A[2]" output="W5LUT[0].in[2]"/><direct name="WLUT_A3_1" input="WLUT.A[2]" output="W5LUT[1].in[2]"/>
        <direct name="WLUT_A2_0" input="WLUT.A[1]" output="W5LUT[0].in[1]"/><direct name="WLUT_A2_1" input="WLUT.A[1]" output="W5LUT[1].in[1]"/>
        <direct name="WLUT_A1_0" input="WLUT.A[0]" output="W5LUT[0].in[0]"/><direct name="WLUT_A1_1" input="WLUT.A[0]" output="W5LUT[1].in[0]"/>
        <direct name="O5"        input="W5LUT[0].out" output="WLUT.O5"/>    <direct name="O6" input="W5LUT[1].out" output="WLUT.O6"/>
      </interconnect>
    </mode>
  </pb_type>

  <!-- D5FF, C5FF, B5FF, A5FF == W5FF -->
  <pb_type name="W5FF" num_pb="4">
    <input name="D" num_pins="1"/>
    <input name="CE" num_pins="1"/>
    <clock name="CK" num_pins="1"/>
    <input name="SR" num_pins="1"/>
    <output name="Q" num_pins="1"/>

    <xi:include href="../../../vpr/ff/pb_type.xml"/>
    <interconnect>
      <direct name="D" input="W5FF.D" output="FF.D"/>
      <direct name="Q" input="FF.Q" output="W5FF.Q"/>
      <direct name="C" input="W5FF.CK" output="FF.clk"/>
    </interconnect>
  </pb_type>

  <!-- DFF, CFF, BFF, AFF == WFF -->
  <pb_type name="WFF" num_pb="4">
    <input name="D" num_pins="1"/>
    <input name="CE" num_pins="1"/>
    <clock name="CK" num_pins="1"/>
    <input name="SR" num_pins="1"/>
    <output name="Q" num_pins="1"/>

    <xi:include href="../../../vpr/ff/pb_type.xml"/>
    <interconnect>
      <direct name="D" input="WFF.D" output="FF.D"/>
      <direct name="Q" input="FF.Q" output="WFF.Q"/>
      <direct name="C" input="WFF.CK" output="FF.clk"/>
    </interconnect>
  </pb_type>

  <xi:include href="../muxes/f7amux/pb_type.xml"/>
  <xi:include href="../muxes/f7bmux/pb_type.xml"/>
  <xi:include href="../muxes/f8mux/pb_type.xml"/>

  <pb_type name="CARRY" num_pb="1">
   <input name="S"  num_pins="4"/>
   <input name="DI" num_pins="4"/>

   <output name="CO" num_pins="4"/>
   <output name="O"  num_pins="4"/>

   <input name="CIN"    num_pins="1"/>
   <input name="CYINIT" num_pins="1"/>

   <mode name="DIRECT">
    <xi:include href="../carry4/pb_type.xml"/>
    <interconnect>
     <direct name="S"   input="CARRY.S"   output="CARRY4.S"/>
     <direct name="DI"  input="CARRY.DI"  output="CARRY4.DI"/>
     <direct name="CO"  input="CARRY4.CO" output="CARRY.CO"/>
     <direct name="O"   input="CARRY4.O"  output="CARRY.O"/>
     <direct name="CIN" input="CARRY.CIN" output="CARRY4.CIN"/>
     <direct name="CYINIT" input="CARRY.CYINIT" output="CARRY4.CYINIT"/>
    </interconnect>
   </mode>
   <mode name="PARTS">
    <xi:include href="../carry-parts/carry4_wmux/pb_type.xml" />
    <xi:include href="../carry-parts/carry4_wxor/pb_type.xml" />
    <xi:include href="../carry-parts/carry4_cin_mux/pb_type.xml" />

    <interconnect>
     <direct name="CIN"    input="CARRY.CIN"    output="CARRY4_CIN_MUX.CIN"/>
     <direct name="CYINIT" input="CARRY.CYINIT" output="CARRY4_CIN_MUX.CYINIT"/>

     <direct name="MUX0_I0" input="CARRY.DI[0]" output="CARRY4_WMUX[0].I0"/><direct name="MUX0_I1" input="CARRY4_CIN_MUX.OUT" output="CARRY4_WMUX[0].I0"/><direct name="MUX0_S" input="CARRY.S[0]" output="CARRY4_WMUX[0].S"/><direct name="MUX0_O" input="CARRY4_WMUX[0].OUT" output="CARRY.CO[0]"/>
     <direct name="MUX1_I0" input="CARRY.DI[1]" output="CARRY4_WMUX[1].I0"/><direct name="MUX1_I1" input="CARRY4_WMUX[0].OUT" output="CARRY4_WMUX[1].I1"/><direct name="MUX1_S" input="CARRY.S[1]" output="CARRY4_WMUX[1].S"/><direct name="MUX1_O" input="CARRY4_WMUX[1].OUT" output="CARRY.CO[1]"/>
     <direct name="MUX2_I0" input="CARRY.DI[2]" output="CARRY4_WMUX[2].I0"/><direct name="MUX2_I1" input="CARRY4_WMUX[1].OUT" output="CARRY4_WMUX[2].I1"/><direct name="MUX2_S" input="CARRY.S[2]" output="CARRY4_WMUX[2].S"/><direct name="MUX2_O" input="CARRY4_WMUX[2].OUT" output="CARRY.CO[2]"/>
     <direct name="MUX3_I0" input="CARRY.DI[3]" output="CARRY4_WMUX[3].I0"/><direct name="MUX3_I1" input="CARRY4_WMUX[2].OUT" output="CARRY4_WMUX[3].I1"/><direct name="MUX3_S" input="CARRY.S[3]" output="CARRY4_WMUX[3].S"/><direct name="MUX3_O" input="CARRY4_WMUX[3].OUT" output="CARRY.CO[3]"/>

     <direct name="XOR0_LI" input="CARRY.S[0]" output="CARRY4_WXOR[0].LI"/><direct name="XOR0_CI" input="CARRY4_CIN_MUX.OUT" output="CARRY4_WXOR[0].CI"/><direct name="XOR0_O" input="CARRY4_WXOR[0].O" output="CARRY.O[0]"/>
     <direct name="XOR1_LI" input="CARRY.S[1]" output="CARRY4_WXOR[1].LI"/><direct name="XOR1_CI" input="CARRY4_WMUX[0].OUT" output="CARRY4_WXOR[1].CI"/><direct name="XOR1_O" input="CARRY4_WXOR[1].O" output="CARRY.O[1]"/>
     <direct name="XOR2_LI" input="CARRY.S[2]" output="CARRY4_WXOR[2].LI"/><direct name="XOR2_CI" input="CARRY4_WMUX[1].OUT" output="CARRY4_WXOR[2].CI"/><direct name="XOR2_O" input="CARRY4_WXOR[2].O" output="CARRY.O[2]"/>
     <direct name="XOR3_LI" input="CARRY.S[3]" output="CARRY4_WXOR[3].LI"/><direct name="xOR3_CI" input="CARRY4_WMUX[2].OUT" output="CARRY4_WXOR[3].CI"/><direct name="XOR3_O" input="CARRY4_WXOR[3].O" output="CARRY.O[3]"/>
    </interconnect>
   </mode>
  </pb_type>

  <!--
  <pb_type name="COUT_USED" num_pb="1" blif_model="">
    <input name="I0" num_pins="1"/>
    <input name="O0" num_pins="1"/>
  </pb_type>
  -->

  <!-- DUSED, CUSED, BUSED, AUSED
  <pb_type name="USED" num_pb="4" blif_model="">
    <input name="I0" num_pins="1"/>
    <input name="O0" num_pins="1"/>
  </pb_type>
  -->

  <interconnect>
    <!-- Repeat 4 times -->
    <direct name="D" input="CLBLL.D" output="WLUT[3].A" />
    <direct name="C" input="CLBLL.C" output="WLUT[2].A" />
    <direct name="B" input="CLBLL.B" output="WLUT[1].A" />
    <direct name="A" input="CLBLL.A" output="WLUT[0].A" />

    <!-- MUX for input to 5 flip-flop output. -->
    <mux
        name="D5FFMUX"
        input="
            CLBLL.DX
            WLUT[3].O5
        "
        output="W5FF[3].D"
    />
    <mux
        name="C5FFMUX"
        input="
            CLBLL.CX
            WLUT[2].O5
        "
        output="W5FF[2].D"
    />
    <mux
        name="B5FFMUX"
        input="
            CLBLL.BX
            WLUT[1].O5
        "
        output="W5FF[1].D"
    />
    <mux
        name="A5FFMUX"
        input="
            CLBLL.AX
            WLUT[0].O5
        "
        output="W5FF[0].D"
    />

    <!-- MUX for carry output. -->
    <mux
        name="DCYO"
        input="
            CLBLL.DX
            WLUT[3].O5
        "
        output="CARRY.DI[3]"
    />
    <mux
        name="CCYO"
        input="
            CLBLL.CX
            WLUT[2].O5
        "
        output="CARRY.DI[2]"
    />
    <mux
        name="BCYO"
        input="
            CLBLL.BX
            WLUT[1].O5
        "
        output="CARRY.DI[1]"
    />
    <mux
        name="ACYO"
        input="
            CLBLL.AX
            WLUT[0].O5
        "
        output="CARRY.DI[0]"
    />

    <!-- MUX for WMUX values. -->
    <mux
        name="DOUTMUX"
        input="
            W5FF[3].Q
            CARRY.O[3]
            WLUT[3].O6
            WLUT[3].O5
            CARRY.CO[3]
            "
        output="CLBLL.DMUX"
    />
    <mux
        name="COUTMUX"
        input="
            W5FF[2].Q
            CARRY.O[2]
            WLUT[2].O6
            WLUT[2].O5
            F7BMUX.O
            CARRY.CO[2]
            "
        output="CLBLL.CMUX"
    />
    <mux
        name="BOUTMUX"
        input="
            W5FF[1].Q
            CARRY.O[1]
            WLUT[1].O6
            WLUT[1].O5
            F8MUX.O
            CARRY.CO[1]
            "
        output="CLBLL.BMUX"
    />
    <mux
        name="AOUTMUX"
        input="
            W5FF[0].Q
            CARRY.O[0]
            WLUT[0].O6
            WLUT[0].O5
            F7BMUX.O
            CARRY.CO[0]
            "
        output="CLBLL.AMUX"
    />

    <!-- Muxes for WFF input -->
    <mux
        name="DFFMUX"
        input="
            CARRY.O[3]
            WLUT[3].O6
            WLUT[3].O5
            CLBLL.DX
            CARRY.CO[3]
            "
        output="WFF[3].D"
    />
    <mux
        name="CFFMUX"
        input="
            CARRY.O[2]
            WLUT[2].O6
            WLUT[2].O5
            F7BMUX.O
            CARRY.CO[2]
            CLBLL.CX
            "
        output="WFF[2].D"
    />
    <mux
        name="BFFMUX"
        input="
            CARRY.O[1]
            WLUT[1].O6
            WLUT[1].O5
            F8MUX.O
            CARRY.CO[1]
            CLBLL.BX
            "
        output="WFF[1].D"
    />
    <mux
        name="AFFMUX"
        input="
            CARRY.O[0]
            WLUT[3].O6
            WLUT[3].O5
            F7AMUX.O
            CARRY.CO[0]
            CLBLL.AX
            "
        output="WFF[0].D"
    />

    <direct name="WFF[3]" input="WFF[3].Q" output="CLBLL.AQ" />
    <direct name="WFF[2]" input="WFF[2].Q" output="CLBLL.BQ" />
    <direct name="WFF[1]" input="WFF[1].Q" output="CLBLL.CQ" />
    <direct name="WFF[0]" input="WFF[0].Q" output="CLBLL.DQ" />

    <!-- LUT O6 output -->
    <direct name="F7BMUX_I0" input="WLUT[3].O6" output="F7BMUX.I0" /><direct name="CARRY_S3" input="WLUT[3].O6" output="CARRY.S[3]" /><direct name="CLBLL_Dout" input="WLUT[3].O6" output="CLBLL.Dout" />
    <direct name="F7BMUX_I1" input="WLUT[2].O6" output="F7BMUX.I1" /><direct name="CARRY_S2" input="WLUT[2].O6" output="CARRY.S[2]" /><direct name="CLBLL_Cout" input="WLUT[2].O6" output="CLBLL.Cout" />
    <direct name="F7AMUX_I0" input="WLUT[1].O6" output="F7AMUX.I0" /><direct name="CARRY_S1" input="WLUT[1].O6" output="CARRY.S[1]" /><direct name="CLBLL_Bout" input="WLUT[1].O6" output="CLBLL.Bout" />
    <direct name="F7AMUX_I1" input="WLUT[0].O6" output="F7AMUX.I1" /><direct name="CARRY_S0" input="WLUT[0].O6" output="CARRY.S[0]" /><direct name="CLBLL_Aout" input="WLUT[0].O6" output="CLBLL.Aout" />

    <!-- Select lines for F7 MUXes -->
    <direct name="CX7S" input="CLBLL.CX" output="F7BMUX.S" />
    <direct name="AX7S" input="CLBLL.AX" output="F7AMUX.S" />

    <!-- F8MUX -->
    <direct name="F8MUX_IN0" input="F7BMUX.O" output="F8MUX.I0" />
    <direct name="F8MUX_IN1" input="F7AMUX.O" output="F8MUX.I1" />
    <direct name="F8MUX_S"   input="CLBLL.BX" output="F8MUX.S" />
    <!-- <direct name="F8MUX_O"   input="F8MUX.O" output="" /> -->

    <!-- Carry -->
    <direct name="CYINIT"    input="CLBLL.AX"  output="CARRY.CYINIT" />
    <direct name="CARRY_IN"  input="CLBLL.CARRY_IN" output="CARRY.CIN" />
    <direct name="CARRY_OUT" input="CARRY.CO[3]" output="CLBLL.CARRY_OUT" />

    <!-- Clock, Clock Enable and Reset -->
    <direct name="W5FF0_CK" input="CLBLL.CLK" output="W5FF[0].CK"/><direct name="WFF0_CK" input="CLBLL.CLK" output="WFF[0].CK"/>
    <direct name="W5FF1_CK" input="CLBLL.CLK" output="W5FF[1].CK"/><direct name="WFF1_CK" input="CLBLL.CLK" output="WFF[1].CK"/>
    <direct name="W5FF2_CK" input="CLBLL.CLK" output="W5FF[2].CK"/><direct name="WFF2_CK" input="CLBLL.CLK" output="WFF[2].CK"/>
    <direct name="W5FF3_CK" input="CLBLL.CLK" output="W5FF[3].CK"/><direct name="WFF3_CK" input="CLBLL.CLK" output="WFF[3].CK"/>

    <!-- <mux name="CEUSED" input="VCC CLBLL.CE" output="{}"/> -->
    <direct name="W5FF0_CE" input="CLBLL.CE"  output="W5FF[0].CE"/><direct name="WFF0_CE" input="CLBLL.CE"  output="WFF[0].CE"/>
    <direct name="W5FF1_CE" input="CLBLL.CE"  output="W5FF[1].CE"/><direct name="WFF1_CE" input="CLBLL.CE"  output="WFF[1].CE"/>
    <direct name="W5FF2_CE" input="CLBLL.CE"  output="W5FF[2].CE"/><direct name="WFF2_CE" input="CLBLL.CE"  output="WFF[2].CE"/>
    <direct name="W5FF3_CE" input="CLBLL.CE"  output="W5FF[3].CE"/><direct name="WFF3_CE" input="CLBLL.CE"  output="WFF[3].CE"/>

    <!-- <mux name="SRUSED" input="GND CLBLL.SR" output="{}"/> -->
    <direct name="W5FF0_SR" input="CLBLL.SR"  output="W5FF[0].SR"/><direct name="WFF0_SR" input="CLBLL.SR"  output="WFF[0].SR"/>
    <direct name="W5FF1_SR" input="CLBLL.SR"  output="W5FF[1].SR"/><direct name="WFF1_SR" input="CLBLL.SR"  output="WFF[1].SR"/>
    <direct name="W5FF2_SR" input="CLBLL.SR"  output="W5FF[2].SR"/><direct name="WFF2_SR" input="CLBLL.SR"  output="WFF[2].SR"/>
    <direct name="W5FF3_SR" input="CLBLL.SR"  output="W5FF[3].SR"/><direct name="WFF3_SR" input="CLBLL.SR"  output="WFF[3].SR"/>

  </interconnect>
</pb_type>
