<!-- A diagram for the SLICEL is shown in;
    7 Series FPGAs CLB User Guide UG474 (v1.8) September 27, 2016
    Figure 2-4: Diagram of SLICEL
  -->
<pb_type name="CLBLL">

  <input name="DX" num_pins="1" equivalent="false"/>
  <input name="D" num_pins="6" equivalent="false"/>

  <input name="CX" num_pins="1" equivalent="false"/>
  <input name="C" num_pins="6" equivalent="false"/>

  <input name="BX" num_pins="1" equivalent="false"/>
  <input name="B" num_pins="6" equivalent="false"/>

  <input name="AX" num_pins="1" equivalent="false"/>
  <input name="A" num_pins="6" equivalent="false"/>

  <input name="SR" num_pins="1" equivalent="false"/>
  <input name="CE" num_pins="1" equivalent="false"/>

  <clock name="CLK"/>

  <input name="CARRY_IN" num_pins="1" equivalent="false"/>
  <output name="CARRY_OUT" num_pins="1" equivalent="false"/>

  <output name="DMUX" num_pins="1" equivalent="false"/>
  <output name="Dout" num_pins="1" equivalent="false"/>
  <output name="DQ" num_pins="1" equivalent="false"/>

  <output name="CMUX" num_pins="1" equivalent="false"/>
  <output name="Cout" num_pins="1" equivalent="false"/>
  <output name="CQ" num_pins="1" equivalent="false"/>

  <output name="BMUX" num_pins="1" equivalent="false"/>
  <output name="Bout" num_pins="1" equivalent="false"/>
  <output name="BQ" num_pins="1" equivalent="false"/>

  <output name="AMUX" num_pins="1" equivalent="false"/>
  <output name="Aout" num_pins="1" equivalent="false"/>
  <output name="AQ" num_pins="1" equivalent="false"/>

  <!-- D6LUT, C6LUT, B6LUT, A6LUT == W6LUT
       A fracturable 6 input LUT. Can either be;
        - 2 * 5 input, 1 output LUT
        - 1 * 6 input, 1 output LUT
    -->
  <pb_type name="WLUT" num_pb="4">
    <input name="A" num_pins="6" port_class="lut_in" />
    <output name="O5" num_pins="1" port_class="lut_out" />
    <output name="O6" num_pins="1" port_class="lut_out" />
    <mode name="lut6">
      <pb_type name="W6LUT" num_pb="1" class="lut" blif_model=".names">
        <input name="A" num_pins="6" port_class="lut_in" />
        <output name="O" num_pins="1" port_class="lut_out" />
      </pb_type>
    </mode>
    <mode name="lut5x2">
      <pb_type name="W5LUT" num_pb="2" class="lut" blif_model=".names">
        <input name="A" num_pins="5" port_class="lut_in" />
        <output name="O" num_pins="1" port_class="lut_out" />
      </pb_type>
    </mode>
    <interconnect>
      <direct name="WLUT_A6" input="WLUT.A[5]" output="{W6LUT.A[5] W5LUT[0].A[4]}"/>
      <direct name="WLUT_A5" input="WLUT.A[4]" output="{W6LUT.A[4] W5LUT[1].A[4]}"/>
      <mux name="O6" input="W6LUT.O W5LUT[0].O" output="W6LUT.O6"/>
      <direct name="O5" input="W5LUT[0].O" output="W5LUT.O5"/>

      <direct name="WLUT_A4" input="WLUT.A[3]" output="{W6LUT.A[3] W5LUT[0].A[3] W5LUT[1].A[3]}"/>
      <direct name="WLUT_A3" input="WLUT.A[2]" output="{W6LUT.A[2] W5LUT[0].A[2] W5LUT[1].A[2]}"/>
      <direct name="WLUT_A2" input="WLUT.A[1]" output="{W6LUT.A[1] W5LUT[0].A[1] W5LUT[1].A[1]}"/>
      <direct name="WLUT_A1" input="WLUT.A[0]" output="{W6LUT.A[0] W5LUT[0].A[0] W5LUT[1].A[0]}"/>
    </interconnect>
  </pb_type>

  <!-- D5FF, C5FF, B5FF, A5FF == W5FF -->
  <pb_type name="W5FF" num_pb="4" class="flipflop" blif_model=".latch">
    <input name="D" num_pins="1" port_class="D" />
    <input name="CE" num_pins="1"/>
    <clock name="CK" num_pins="1" port_class="clock" />
    <input name="SR" num_pins="1"/>
    <output name="Q" num_pins="1" port_class="Q" />
  </pb_type>

  <!-- DFF, CFF, BFF, AFF == WFF -->
  <pb_type name="WFF" num_pb="4" class="flipflop" blif_model=".latch">
    <input name="D" num_pins="1" port_class="D" />
    <input name="CE" num_pins="1"/>
    <clock name="CK" num_pins="1" port_class="clock" />
    <input name="SR" num_pins="1"/>
    <output name="Q" num_pins="1" port_class="Q" />
  </pb_type>

  <pb_type name="F7BMUX" num_pb="1" blif_model=".subckt MUXF7">
    <input name="I0" num_pins="1"/>
    <input name="I1" num_pins="1"/>
    <input name="S0" num_pins="1"/>
    <output name="OUT" num_pins="1"/>
  </pb_type>

  <pb_type name="F7AMUX" num_pb="1" blif_model=".subckt MUXF7">
    <input name="I0" num_pins="1"/>
    <input name="I1" num_pins="1"/>
    <input name="S0" num_pins="1"/>
    <output name="OUT" num_pins="1"/>
  </pb_type>

  <pb_type name="F8MUX" num_pb="1" blif_model=".subckt MUXF8">
    <input name="I0" num_pins="1"/>
    <input name="I1" num_pins="1"/>
    <input name="S0" num_pins="1"/>
    <output name="OUT" num_pins="1"/>
  </pb_type>

  <pb_type name="CARRY4" num_pb="1" blif_model=".subckt CARRY4">
    <input name="S"  num_pins="4"/>
    <input name="DI" num_pins="4"/>

    <output name="CO" num_pins="4"/>
    <output name="O"  num_pins="4"/>

    <input name="CIN"    num_pins="1"/>
    <input name="CYINIT" num_pins="1"/>

    <!-- CARRY4_DMUX, CARRY4_CMUX, CARRY4_BMUX, CARRY4_AMUX == CARRY4_WMUX -->
    <pb_type name="CARRY4_WMUX" num_pb="4" blif_model=".subckt MUXCY">
      <input name="I0" num_pins="1"/>
      <input name="I1" num_pins="1"/>
      <input name="S0" num_pins="1"/>
      <output name="OUT" num_pins="1"/>
    </pb_type>

    <!-- CARRY4_DXOR, CARRY4_CXOR, CARRY4_BXOR, CARRY4_AXOR -->
    <pb_type name="CARRY4_WXOR" num_pb="4" blif_model=".subckt XORCY">
      <input name="I0" num_pins="1"/>
      <input name="I1" num_pins="1"/>
      <input name="S0" num_pins="1"/>
      <output name="OUT" num_pins="1"/>
    </pb_type>

    <interconnect>
      <direct name="S0" input="CARRY4.S[0]" output="{CARRY4_WMUX[0].S0 CARRY4_XOR[0].I0}"/>
      <direct name="S1" input="CARRY4.S[1]" output="{CARRY4_WMUX[1].S0 CARRY4_XOR[1].I0}"/>
      <direct name="S2" input="CARRY4.S[2]" output="{CARRY4_WMUX[2].S0 CARRY4_XOR[2].I0}"/>
      <direct name="S3" input="CARRY4.S[3]" output="{CARRY4_WMUX[3].S0 CARRY4_XOR[3].I0}"/>

      <direct name="DI3_MUX" input="CARRY4.DI[3]" output="CARRY4_WMUX[3].I0"/>
      <direct name="DI2_MUX" input="CARRY4.DI[2]" output="CARRY4_WMUX[2].I0"/>
      <direct name="DI1_MUX" input="CARRY4.DI[1]" output="CARRY4_WMUX[1].I0"/>
      <direct name="DI0_MUX" input="CARRY4.DI[0]" output="CARRY4_WMUX[0].I0"/>

      <direct name="XOR_O3" input="CARRY4_WXOR[3].O" output="CARRY4.O[3]"/>
      <direct name="XOR_O2" input="CARRY4_WXOR[2].O" output="CARRY4.O[2]"/>
      <direct name="XOR_O1" input="CARRY4_WXOR[1].O" output="CARRY4.O[1]"/>
      <direct name="XOR_O0" input="CARRY4_WXOR[0].O" output="CARRY4.O[0]"/>

      <direct name="MUX_CO3" input="CARRY4_WMUX[3].OUT" output="{CARRY4.CO[3]}"/>
      <direct name="MUX_CO2" input="CARRY4_WMUX[2].OUT" output="{CARRY4.CO[2] CARRY4.WMUX[3].I1 CARRY4.WXOR[1].I3}"/>
      <direct name="MUX_CO1" input="CARRY4_WMUX[1].OUT" output="{CARRY4.CO[1] CARRY4.WMUX[2].I1 CARRY4.WXOR[1].I2}"/>
      <direct name="MUX_CO0" input="CARRY4_WMUX[0].OUT" output="{CARRY4.CO[0] CARRY4.WMUX[1].I1 CARRY4.WXOR[1].I1}"/>

      <!-- This is shown as a routing BEL outside CARRY4 object but is logically part of the CARRY4 as it selects between CIN and CYINIT -->
      <mux name="CYINIT" input="VCC CARRY4.CYINIT CARRY4.CIN GND" output="{CARRY4.WMUX[0].I1 CARRY4.XOR[0].I1}"/>
    </interconnect>

  </pb_type>

  <!--
  <pb_type name="COUT_USED" num_pb="1" blif_model="">
    <input name="I0" num_pins="1"/>
    <input name="O0" num_pins="1"/>
  </pb_type>
  -->

  <!-- DUSED, CUSED, BUSED, AUSED
  <pb_type name="USED" num_pb="4" blif_model="">
    <input name="I0" num_pins="1"/>
    <input name="O0" num_pins="1"/>
  </pb_type>
  -->

  <interconnect>
    <!-- COUT_USED -->
    <direct name="COUT" input="CARRY4.CO3" output="A7_SLICEL.COUT" />

    <!-- Repeat 4 times -->
    <direct name="D" input="A7_SLICEL.D" output="W6LUT[3].A" />
    <direct name="C" input="A7_SLICEL.C" output="W6LUT[2].A" />
    <direct name="B" input="A7_SLICEL.B" output="W6LUT[1].A" />
    <direct name="A" input="A7_SLICEL.A" output="W6LUT[0].A" />

    <!-- MUX for input to 5 flip-flop output. -->
    <mux
        name="D5FFMUX"
        input="
            A7_SLICEL.DX
            WLUT[3].O5
        "
        output="W5FF[3].D"
    />
    <mux
        name="C5FFMUX"
        input="
            A7_SLICEL.CX
            WLUT[2].O5
        "
        output="W5FF[2].D"
    />
    <mux
        name="B5FFMUX"
        input="
            A7_SLICEL.BX
            WLUT[1].O5
        "
        output="W5FF[1].D"
    />
    <mux
        name="A5FFMUX"
        input="
            A7_SLICEL.AX
            WLUT[0].O5
        "
        output="W5FF[0].D"
    />

    <!-- MUX for carry output. -->
    <mux
        name="DCYO"
        input="
            A7_SLICEL.DX
            WLUT[3].O5
        "
        output="CARRY4.DI3"
    />
    <mux
        name="CCYO"
        input="
            A7_SLICEL.CX
            WLUT[2].O5
        "
        output="CARRY4.DI2"
    />
    <mux
        name="BCYO"
        input="
            A7_SLICEL.BX
            WLUT[1].O5
        "
        output="CARRY4.DI1"
    />
    <mux
        name="ACYO"
        input="
            A7_SLICEL.AX
            WLUT[0].O5
        "
        output="CARRY4.DI0"
    />

    <!-- MUX for WMUX values. -->
    <mux
        name="DOUTMUX"
        input="
            W5FF[3].Q
            CARRY4.O[3]
            W5LUT[3].O6
            W5LUT[3].O5
            CARRY4.CO[3]
            "
        output="A7_SLICEL.DMUX"
    />
    <mux
        name="COUTMUX"
        input="
            W5FF[2].Q
            CARRY4.O[2]
            W5LUT[2].O6
            W5LUT[2].O5
            F7BMUX.O
            CARRY4.CO[2]
            "
        output="A7_SLICEL.CMUX"
    />
    <mux
        name="BOUTMUX"
        input="
            W5FF[1].Q
            CARRY4.O[1]
            W5LUT[1].O6
            W5LUT[1].O5
            F8MUX.O
            CARRY4.CO[1]
            "
        output="A7_SLICEL.BMUX"
    />
    <mux
        name="AOUTMUX"
        input="
            W5FF[0].Q
            CARRY4.O[0]
            W5LUT[0].O6
            W5LUT[0].O5
            F7BMUX.O
            CARRY4.CO[0]
            "
        output="A7_SLICEL.AMUX"
    />

    <!-- Muxes for WFF input -->
    <mux
        name="DFFMUX"
        input="
            CARRY4.O[3]
            W5LUT[3].O6
            W5LUT[3].O5
            A7_SLICEL.DX
            CARRY4.CO[3]
            "
        output="WFF[3].D"
    />
    <mux
        name="CFFMUX" 
        input="
            CARRY4.O[2]
            W5LUT[2].O6
            W5LUT[2].O5
            F7BMUX.O
            CARRY4.CO[2]
            A7_SLICEL.CX
            "
        output="WFF[2].D"
    />
    <mux
        name="BFFMUX"
        input="
            CARRY4.O[1]
            W5LUT[1].O6
            W5LUT[1].O5
            F8MUX.O
            CARRY4.CO[1]
            A7_SLICEL.BX
            "
        output="WFF[1].D"
    />
    <mux
        name="AFFMUX"
        input="
            CARRY4.O[0]
            W5LUT[3].O6
            W5LUT[3].O5
            F7AMUX.O
            CARRY4.CO[0]
            A7_SLICEL.AX
            "
        output="WFF[0].D"
    />

    <!-- LUT O6 output -->
    <direct name="DLUT_O6" input="WLUT[3].O6" output="{F7BMUX.I0 CARRY4.S3 A7_SLICEL.Dout}" />
    <direct name="CLUT_O6" input="WLUT[2].O6" output="{F7BMUX.I1 CARRY4.S2 A7_SLICEL.Cout}" />
    <direct name="BLUT_O6" input="WLUT[1].O6" output="{F7AMUX.I0 CARRY4.S1 A7_SLICEL.Bout}" />
    <direct name="ALUT_O6" input="WLUT[0].O6" output="{F7AMUX.I1 CARRY4.S0 A7_SLICEL.Aout}" />

    <!-- Select lines for F7 MUXes -->
    <direct name="CX7" input="A7_SLICEL.CX" output="F7BMUX.S" />
    <direct name="AX7" input="A7_SLICEL.AX" output="{F7AMUX.S CARRY4.CYINIT}" />
    <!-- F8MUX -->
    <direct name="F8MUX_IN0" input="F7BMUX.O" output="F8MUX.I0" />
    <direct name="F8MUX_IN1" input="F7AMUX.O" output="F8MUX.I1" />
    <direct name="F8MUX_S"   input="A7_SLICEL.BX" output="F8MUX.S" />
    <direct name="F8MUX_O"   input="F8MUX.O" output="" />

    <!-- Carry -->
    <direct name="CARRY_IN"  input="A7_SLICE.CARRY_IN" output="CARRY4.CIN" />
    <direct name="CARRY_OUT" input="CARRY4.CO3" output="A7_SLICE.CARRY_OUT" />

    <!-- Clock, Clock Enable and Reset -->
    <complete name="CK" input="A7_SLICEL.CLK" output="{W5FF.CK WFF.CK}"/>
    <!-- <mux name="CEUSED" input="VCC A7_SLICEL.CE" output="{}"/> -->
    <complete name="CE" input="A7_SLICEL.CE"  output="{W5FF.CE WFF.CE}"/>
    <!-- <mux name="SRUSED" input="GND A7_SLICEL.SR" output="{}"/> -->
    <complete name="SR" input="A7_SLICEL.SR"  output="{W5FF.SR WFF.SR}"/>

  </interconnect>
</pb_type>
